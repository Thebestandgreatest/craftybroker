A broker for [Impulse](https://github.com/Arson-Club/Impulse) to interact with [Crafty Controller](https://gitlab.com/crafty-controller/crafty-4) using the api

<h1>Installation</h1>
Download the latest release from the releases page, and put the jar in the plugins/impulse directory. It should be the same directory as the config. Then change the config to allow the broker to stop and start your servers

You then need to export the key generated by crafty controller, this requires sudo user access

Note:
Docker is faily similar, just run
```bash
docker exec -it crafty_container
```
To enter the docker container with a shell


The commands are the same just with different default paths

<h4>Navigates to your crafty install certs directory</h4>

```bash
cd /var/opt/minecraft/crafty/crafty-4/app/config/web/certs
```
Docker
```bash
cd /crafty/app/config/web/certs
```

<h4>Converts the certificate to a type the keystore likes</h4>

Uses the default crafty linux install location
```bash
openssl x509 -outform der -in commander.cert.pem -out crafty-cert.der
```

<h4>Navigates to your java home directory</h4>

Uses the default java 21 openjdk install for amd64 architecture
```bash
cd /usr/lib/jvm/java-21/openjdk-amd64/lib/security
```

<h4>Imports the certificate into the java root store so it trusts crafty </h4>
Uses the default location, and default password for certs "changeit"

```bash
sudo keytool -import -alias "crafty-ca" -file /var/opt/minecraft/crafty/crafty-4/app/config/web/certs/crafty-cert.der -keystore cacerts -storepass changeit -noprompt
```
Docker
```bash
sudo keytool -import -alias "crafty-ca" -file /crafty/app/config/web/certs/crafty-cert.der -keystore cacerts -storepass changeit -noprompt
```

<h1>Usage</h1>

Example Config:
```yaml
servers:
  - name: "lobby"
    type: "crafty"
    crafty:
       serverID: "SERVER_ID_HERE"
       token: "TOKEN_HERE"
       craftyAddress: "https://localhost:8443"
```
</p>
Explanation of config:

```yaml
servers:
  name: "lobby"
  type: "crafty"
```
Required by Impulse

Need to set crafty as the type

```yaml
crafty:
  serverID: "SERVER_ID_HERE"
  token: "TOKEN_HERE"
  craftyAddress: "https://localhost:8443"
```
<ul>
  <li><b>serverID:</b> found in the url of the server as you are on the page in the crafty web ui, also listed just below the name of the server as UUID</li>
  <li><b>token:</b> found by making an API Key in the crafty settings page where you manage users, click on a user, click on api keys, and make a new one with the COMMANDS permission then scroll the new table entry over until you see get token. Use that as your token. Make sure that the user has access to the servers that Impulse will manage</li>
  <li><b>craftyAddress</b> address where you access the crafty controller web ui, defaults to https://localhost:8443</li>
</ul>
